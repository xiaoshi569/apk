# V免签应用内日志功能使用说明

## 🎯 功能介绍

现在V免签已经内置了日志查看功能，您可以直接在手机上查看支付宝和微信的监听状态，无需连接电脑使用ADB。

## 📱 使用步骤

### 1. 重新编译安装APK
- 使用修改后的代码重新编译APK
- 安装到手机上

### 2. 打开V免签应用
- 您会看到新增了两个按钮：
  - **支付宝调试**：检测支付宝安装状态
  - **查看日志**：查看实时监听日志

### 3. 查看日志功能
点击"查看日志"按钮，进入日志查看界面：
- **刷新日志**：获取最新的日志信息
- **清除日志**：清空所有历史日志
- **日志显示区**：显示详细的监听过程

## 📊 日志内容说明

### 日志图标含义
- ✅ **成功检测**：成功检测到相关通知
- 🔍 **发现通知**：发现支付宝相关通知
- 🎯 **关键词匹配**：匹配到收款关键词
- 💰 **金额提取**：成功提取到收款金额
- ❌ **错误**：出现错误或失败
- ⚠️ **警告**：需要注意的情况

### 典型日志示例

**正常支付宝收款流程：**
```
[12-25 14:30:15] 收到新通知
[12-25 14:30:15] 通知详情 - 包名: com.eg.android.AlipayGphone, 标题: 支付宝, 内容: 张三通过扫码向你付款1.00元
[12-25 14:30:15] 🔍 发现支付宝相关通知！包名: com.eg.android.AlipayGphone
[12-25 14:30:15] ✅ 检测到支付宝通知 - 包名: com.eg.android.AlipayGphone
[12-25 14:30:15] 支付宝通知内容: 张三通过扫码向你付款1.00元
[12-25 14:30:15] 🎯 匹配到支付宝收款关键词！
[12-25 14:30:15] 💰 成功提取金额: 1.00元，正在回调服务端...
[12-25 14:30:16] ✅ 回调服务端成功: success
```

**支付宝通知但未匹配关键词：**
```
[12-25 14:35:20] ✅ 检测到支付宝通知 - 包名: com.eg.android.AlipayGphone
[12-25 14:35:20] 支付宝通知内容: 您的余额宝收益已到账
[12-25 14:35:20] ⚠️ 支付宝通知未匹配收款关键词: 您的余额宝收益已到账
```

**微信收款流程：**
```
[12-25 14:40:10] ✅ 检测到微信通知
[12-25 14:40:10] 微信通知内容: 微信收款1.00元(来自李四)
[12-25 14:40:10] 🎯 匹配到微信收款通知！
[12-25 14:40:10] 💰 成功提取金额: 1.00元，正在回调服务端...
[12-25 14:40:11] ✅ 回调服务端成功: success
```

## 🔧 故障排除

### 1. 没有任何日志
**可能原因：**
- V免签通知监听权限未开启
- 应用被系统杀死

**解决方案：**
- 检查通知监听权限
- 将V免签添加到电池优化白名单

### 2. 有通知但包名不对
**日志示例：**
```
[12-25 14:45:00] 通知详情 - 包名: com.alipay.android.app, 标题: 支付宝, 内容: ...
```
**说明：** 新版支付宝使用了不同的包名，代码已支持

### 3. 有支付宝通知但未匹配关键词
**可能原因：**
- 支付宝通知内容格式变化
- 不是收款相关的通知

**解决方案：**
- 查看具体的通知内容
- 根据实际内容调整关键词匹配

### 4. 匹配到关键词但无法提取金额
**可能原因：**
- 通知内容中金额格式特殊
- getMoney方法的正则表达式需要调整

### 5. 回调服务端失败
**日志示例：**
```
[12-25 14:50:00] ❌ 回调服务端失败: Connection refused
```
**解决方案：**
- 检查服务端地址配置
- 确认服务端正常运行
- 检查网络连接

## 💡 使用技巧

### 1. 实时监控
- 保持日志页面打开
- 进行收款测试
- 观察实时日志变化

### 2. 问题定位
- 先查看是否有通知记录
- 确认包名是否正确
- 检查关键词匹配情况
- 验证金额提取结果

### 3. 性能优化
- 定期清除日志避免占用过多存储
- 日志会自动限制长度，保留最近记录

## 📞 技术支持

如果通过日志仍无法解决问题，请提供：
1. **完整的日志截图**
2. **手机型号和系统版本**
3. **支付宝版本号**
4. **具体的收款测试步骤**

这样可以更准确地定位和解决问题。

## 🔄 更新记录

- **v1.0**：基础日志功能
- **v1.1**：添加图标标识，优化日志格式
- **v1.2**：支持微信和支付宝详细监听日志
- **v1.3**：添加回调状态记录
